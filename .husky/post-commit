#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

GREEN="\033[0;32m"
BLUE="\033[0;34m"
GRAY="\033[0;90m"
RESET="\033[0m"

BRANCH=$(git branch --show-current)

echo ""
echo "${GRAY}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${RESET}"
echo "${BLUE}ğŸ” Husky post-commit hook${RESET}"
echo "${GRAY}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${RESET}"

if [ "$BRANCH" != "main" ]; then
  echo "${GRAY}â„¹ï¸  Skipped â€“ not on MAIN (branch=$BRANCH)${RESET}"
  exit 0
fi

echo "${GREEN}ğŸš€ Post-commit deploy triggered from MAIN${RESET}"
echo "${GRAY}â–¶ Executing deploy-local.sh${RESET}"
echo ""

# Run deploy script
sh ./deploy-local.sh

EXIT_CODE=$?

echo ""
if [ $EXIT_CODE -eq 0 ]; then
  echo "${GREEN}âœ” Deploy completed successfully${RESET}"
else
  echo "${RED}âœ– Deploy failed (exit code=$EXIT_CODE)${RESET}"
fi

exit $EXIT_CODE
